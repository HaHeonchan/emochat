<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>List</title>
    <link href="/main.css" rel="stylesheet">
</head>
<body>
    <div th:replace="~{ nav.html::navbar}"></div>

    <div class="post" th:each="post : ${posts}">
        <a th:href="@{ '/detail/' + ${post.id} }">
            <h3 th:text="${post.title}">title</h3>
            <p th:text="${'auth : '+post.author}">author</p>
            <p th:text="${'date : '+post.date}">date</p>
        </a>
        <button th:attr="onclick=|window.location.href='/edit/' + ${post.id}|" >Edit</button>
        <button th:attr="onclick=|deletePost(${post.id})|">Delete</button>
    </div>

    <script>
        function deletePost(id){
            if (!confirm("Are you sure you want to delete this post?")) {
                return;
            }

            fetch('/delete', {
                method: 'DELETE',
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ id: id.toString() })
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to delete post');
                    }
                    return response.text();
                })
                .then(() => {
                    window.location.reload();
                })
                .catch(error => {
                    alert("Error deleting post: " + error.message);
                });
        }
    </script>
</body>
</html>